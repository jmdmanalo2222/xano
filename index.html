<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pampam pls ğŸ¥º</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;900&family=Caveat:wght@400;700&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --pink:#ff6b9d;--dark-pink:#e0477a;--soft:#fff0f5;
  --yellow:#ffd166;--purple:#c77dff;--text:#3a1a2e;--card:#fff;--red:#ff3860;
}
body{
  min-height:100vh;background:var(--soft);
  background-image:
    radial-gradient(circle at 20% 50%,rgba(255,107,157,.12) 0%,transparent 50%),
    radial-gradient(circle at 80% 20%,rgba(199,125,255,.1) 0%,transparent 40%),
    radial-gradient(circle at 60% 80%,rgba(255,209,102,.1) 0%,transparent 40%);
  display:flex;align-items:center;justify-content:center;
  font-family:'Nunito',sans-serif;overflow:hidden;
  cursor:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ctext y='26' font-size='26'%3EğŸ«¶%3C/text%3E%3C/svg%3E") 12 12,auto;
  position:relative;transition:background 1.2s;
}
body.d1{background:#ffe0ec;}body.d2{background:#ffc0d4;}
body.d3{background:#ffaac6;}body.d4{background:#ff8fb4;}
body.d5{background:#2a0a15;}
body.d5 .card{background:#1a0a0f;border-color:#ff6b9d;}
body.d5 .question,body.d5 .no-count{color:#ff6b9d;}
body.d5 .bubble{background:#3a0f1f;color:#ffb3cf;border-color:#ff6b9d;}
body.d5 .together-wrap{color:#ff8fb4;}
body.d5 .together-wrap span{color:#ffb3cf;}
body.d5 .reasons-wrap{background:rgba(255,107,157,.1);border-color:rgba(255,107,157,.5);color:#ffb3cf;}
body.d5 .reason-label{color:#ff8fb4;}

#particles{position:fixed;inset:0;pointer-events:none;z-index:0;}
#fireworks{position:fixed;inset:0;pointer-events:none;z-index:5;}

#musicBtn{
  position:fixed;top:16px;right:16px;z-index:400;
  background:white;border:2px solid var(--pink);border-radius:50%;
  width:44px;height:44px;font-size:1.3rem;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 2px 12px rgba(255,107,157,.3);transition:transform .2s;
}
#musicBtn:hover{transform:scale(1.15);}

/* â•â• DOOR â•â• */
#door-screen{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;gap:0;}
.door-label{
  font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--purple);
  margin-bottom:14px;opacity:0;animation:fadeUp .6s .3s forwards;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(-12px);}to{opacity:1;transform:translateY(0);}}

.door-frame{
  width:200px;background:linear-gradient(160deg,#8B4513,#6B3410);
  border-radius:16px 16px 0 0;padding:6px;
  box-shadow:0 12px 40px rgba(0,0,0,.25),inset 0 2px 4px rgba(255,255,255,.1);
  opacity:0;animation:fadeUp .6s .5s forwards;
}
.door-arch{
  background:linear-gradient(160deg,#a0522d,#7a3b20);
  border-radius:12px 12px 0 0;height:260px;
  position:relative;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}
.door-left,.door-right{
  position:absolute;top:0;bottom:0;width:50%;
  background:linear-gradient(160deg,#cd853f,#b8722f);
  display:flex;align-items:center;justify-content:center;
  border:2px solid #8B4513;
  transition:transform 1.2s cubic-bezier(.4,0,.2,1);
}
.door-left{left:0;border-radius:12px 0 0 0;transform-origin:left center;}
.door-right{right:0;border-radius:0 12px 0 0;transform-origin:right center;}
.door-left.open{transform:rotateY(-80deg);}
.door-right.open{transform:rotateY(80deg);}
.door-panel{width:38px;height:70px;border:2px solid rgba(139,69,19,.5);border-radius:6px;background:rgba(255,255,255,.07);position:absolute;}
.door-left .door-panel:nth-child(1){top:30px;left:10px;}
.door-left .door-panel:nth-child(2){bottom:30px;left:10px;}
.door-right .door-panel:nth-child(1){top:30px;right:10px;}
.door-right .door-panel:nth-child(2){bottom:30px;right:10px;}
.door-knob{width:12px;height:12px;background:radial-gradient(circle at 35% 35%,#ffd700,#b8860b);border-radius:50%;position:absolute;box-shadow:0 2px 4px rgba(0,0,0,.4);}
.door-left .door-knob{right:6px;}
.door-right .door-knob{left:6px;}
.door-reveal{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;opacity:0;transition:opacity .6s .8s;}
.door-reveal.show{opacity:1;}
.bear-peek{font-size:3.5rem;animation:peekBob 1s ease-in-out infinite;}
@keyframes peekBob{0%,100%{transform:translateY(0);}50%{transform:translateY(-8px);}}
.door-reveal p{font-family:'Fredoka One',cursive;font-size:.9rem;color:#e0477a;text-align:center;padding:0 10px;}
.door-step{width:214px;height:18px;background:linear-gradient(180deg,#5D3A1A,#4a2d12);border-radius:0 0 8px 8px;box-shadow:0 6px 16px rgba(0,0,0,.2);opacity:0;animation:fadeUp .6s .5s forwards;}

.knock-bubble{
  background:white;border:2.5px solid var(--pink);border-radius:20px;
  padding:10px 20px;font-family:'Fredoka One',cursive;font-size:1rem;color:var(--text);
  margin-top:18px;box-shadow:0 4px 16px rgba(255,107,157,.2);
  opacity:0;animation:fadeUp .6s .8s forwards;position:relative;
}
.knock-bubble::before{content:'';position:absolute;top:-10px;left:50%;transform:translateX(-50%);border:5px solid transparent;border-bottom-color:var(--pink);}

.open-btn{
  background:linear-gradient(135deg,#ff6b9d,#e0477a);color:white;border:none;border-radius:50px;
  font-family:'Fredoka One',cursive;font-size:1.1rem;padding:14px 36px;cursor:pointer;margin-top:16px;
  box-shadow:0 6px 24px rgba(255,107,157,.4);opacity:0;animation:fadeUp .6s 1s forwards;
  transition:transform .15s,box-shadow .15s;
}
.open-btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 10px 30px rgba(255,107,157,.5);}
.open-btn:active{transform:scale(.96);}
@keyframes knock{0%,100%{transform:translateX(0);}20%{transform:translateX(-5px);}40%{transform:translateX(5px);}60%{transform:translateX(-3px);}80%{transform:translateX(3px);}}
.knocking{animation:knock .4s ease!important;}

/* â•â• CARD â•â• */
.card{
  position:relative;z-index:10;background:var(--card);border-radius:36px;
  padding:36px 36px 30px;max-width:460px;width:94vw;
  box-shadow:0 8px 60px rgba(255,107,157,.25),0 2px 8px rgba(0,0,0,.07);
  border:3px solid rgba(255,107,157,.2);text-align:center;display:none;
  transition:box-shadow .5s,border-color .5s;
}
@keyframes cardIn{from{opacity:0;transform:scale(.7) translateY(40px);}to{opacity:1;transform:scale(1) translateY(0);}}
.card.visible{display:block;animation:cardIn .7s cubic-bezier(.34,1.56,.64,1) forwards;}
@keyframes hb{0%,100%{box-shadow:0 8px 60px rgba(255,107,157,.25);}50%{box-shadow:0 8px 90px rgba(255,107,157,.65);}}
.ps{animation:hb 2s ease infinite;}
.pf{animation:hb .55s ease infinite;}
.pp{animation:hb .22s ease infinite;}

/* â”€â”€ Bear â”€â”€ */
.bear-wrap{position:relative;display:inline-block;margin-bottom:6px;}
.bear{font-size:5.5rem;display:block;line-height:1;animation:bob 2s ease-in-out infinite;}
@keyframes bob{0%,100%{transform:translateY(0) rotate(-2deg);}50%{transform:translateY(-8px) rotate(2deg);}}
.bear.sad{animation:cry .5s ease-in-out infinite alternate!important;}
@keyframes cry{from{transform:rotate(-6deg) scale(.95);}to{transform:rotate(6deg) scale(1.05);}}
.bear.happy{animation:dance .4s ease infinite!important;}
@keyframes dance{0%{transform:rotate(-15deg) scale(1.1);}50%{transform:rotate(15deg) scale(1.2);}100%{transform:rotate(-15deg) scale(1.1);}}
.bear.faint{animation:faint .7s ease forwards!important;}
@keyframes faint{0%{transform:scale(1) rotate(0);}40%{transform:scale(1.15) rotate(-20deg);}100%{transform:scale(.8) rotate(90deg) translateY(20px);opacity:.4;}}
.tear{position:absolute;font-size:1.1rem;animation:tf .8s ease-in forwards;pointer-events:none;}
@keyframes tf{from{transform:translateY(0);opacity:1;}to{transform:translateY(60px);opacity:0;}}

/* â”€â”€ HP bar â”€â”€ */
.health-wrap{display:flex;align-items:center;gap:8px;justify-content:center;margin-bottom:10px;}
.hl{font-size:.72rem;font-weight:700;color:var(--pink);}
.hbg{flex:1;max-width:160px;background:#ffe0ec;border-radius:20px;height:11px;overflow:hidden;border:1.5px solid rgba(255,107,157,.25);}
.hbar{height:100%;background:linear-gradient(90deg,#2ecc71,#27ae60);border-radius:20px;width:100%;transition:width .5s cubic-bezier(.34,1.56,.64,1),background .5s;}
.hbar.w{background:linear-gradient(90deg,#f39c12,#e67e22);}
.hbar.d{background:linear-gradient(90deg,#e74c3c,#c0392b);}

/* â”€â”€ Bubble â”€â”€ */
.bubble{background:var(--soft);border:2px solid var(--pink);border-radius:20px;padding:10px 18px;font-size:.9rem;font-weight:700;color:var(--text);margin-bottom:14px;min-height:44px;display:flex;align-items:center;justify-content:center;position:relative;transition:all .3s;}
.bubble::after{content:'';position:absolute;bottom:-12px;left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--pink);}

/* â”€â”€ Question â”€â”€ */
.question{font-family:'Fredoka One',cursive;font-size:2.1rem;color:var(--text);margin-bottom:8px;line-height:1.2;}

/* â”€â”€ No counter â”€â”€ */
.no-counter-wrap{
  background:rgba(255,107,157,.07);border-radius:14px;
  padding:7px 14px;margin-bottom:14px;
  font-size:.8rem;font-weight:700;color:#c06080;
  min-height:36px;display:flex;align-items:center;justify-content:center;gap:8px;
  transition:all .3s;border:1.5px solid transparent;
}
.no-counter-wrap.active{border-color:rgba(255,107,157,.3);}
.ncb{
  background:var(--pink);color:white;font-family:'Fredoka One',cursive;
  font-size:1rem;border-radius:50%;width:28px;height:28px;
  display:inline-flex;align-items:center;justify-content:center;
  animation:bp .3s cubic-bezier(.34,1.56,.64,1);
}
@keyframes bp{from{transform:scale(0);}to{transform:scale(1);}}

/* â”€â”€ Buttons â€” flex row, NO absolute â”€â”€ */
.btn-row{display:flex;align-items:center;justify-content:center;gap:22px;min-height:80px;position:relative;}
.btn{border:none;border-radius:50px;font-family:'Fredoka One',cursive;cursor:pointer;outline:none;flex-shrink:0;}
.btn-yes{
  font-size:1.3rem;padding:16px 44px;
  background:linear-gradient(135deg,#ff6b9d,#e0477a);color:white;
  box-shadow:0 6px 24px rgba(255,107,157,.5);
  transition:transform .2s,box-shadow .3s;
}
.btn-yes:hover{transform:translateY(-4px) scale(1.06);box-shadow:0 12px 32px rgba(255,107,157,.6);}
.btn-yes:active{transform:scale(.95);}
.btn-no{
  font-size:1.3rem;padding:16px 44px;
  background:white;color:#ff6b9d;border:2.5px solid #ffb3cf;
  box-shadow:0 3px 12px rgba(0,0,0,.08);
  transition:font-size .4s,padding .4s,opacity .4s,transform .25s cubic-bezier(.34,1.56,.64,1);
}
.btn-no:hover{background:#fff5f8;}

/* â”€â”€ Desperation bar â”€â”€ */
.dbar-wrap{margin-top:14px;background:#ffe0ec;border-radius:20px;height:9px;overflow:hidden;}
.dbar{height:100%;background:linear-gradient(90deg,#06d6a0,#ffd166,#ff6b9d,#c77dff);width:0%;border-radius:20px;transition:width .5s cubic-bezier(.34,1.56,.64,1);}
.dlabel{font-size:.67rem;color:#bbb;margin-top:4px;display:flex;justify-content:space-between;}
.critical{color:var(--red);font-weight:900;display:none;animation:bl .4s ease infinite alternate;}
@keyframes bl{from{opacity:1;}to{opacity:.2;}}

/* â”€â”€ Reasons â”€â”€ */
.reasons-wrap{
  margin-top:14px;background:rgba(255,107,157,.05);border-radius:16px;padding:10px 14px;
  border:1.5px dashed rgba(255,107,157,.3);min-height:42px;
  display:flex;align-items:center;justify-content:center;
  font-family:'Caveat',cursive;font-size:1.08rem;color:var(--text);
  transition:all .4s;cursor:pointer;
}
.reasons-wrap:hover{background:rgba(255,107,157,.1);}
.reason-label{font-size:.65rem;color:#bbb;margin-bottom:2px;font-family:'Nunito',sans-serif;}
#reasonText{transition:opacity .2s;}

/* â”€â”€ Together timer â”€â”€ */
.together-wrap{font-size:.71rem;color:#cba0b8;margin-top:8px;}
.together-wrap span{font-weight:900;color:var(--pink);}

/* â•â• WIN â•â• */
#win-screen{
  display:none;position:relative;z-index:20;
  max-width:500px;width:94vw;
  flex-direction:column;align-items:center;gap:8px;
  margin:0 auto;padding:20px 0 40px;
}
@keyframes popIn{from{opacity:0;transform:scale(.6);}to{opacity:1;transform:scale(1);}}
.win-emoji-row{font-size:3rem;letter-spacing:8px;animation:wgl .5s ease infinite alternate;display:block;text-align:center;margin-bottom:10px;}
@keyframes wgl{from{transform:rotate(-5deg);}to{transform:rotate(5deg);}}

.envelope{width:100%;max-width:440px;margin:0 auto;}
.env-flap-wrap{width:100%;overflow:hidden;height:80px;position:relative;}
.env-flap{
  position:absolute;top:0;left:0;right:0;height:0;
  border-left:50% solid transparent;
  border-right:50% solid transparent;
  border-top:80px solid #ff6b9d;
  transform-origin:top center;transition:transform .9s cubic-bezier(.4,0,.2,1);
}
.env-flap.open{transform:scaleY(-1);}
.env-body{background:linear-gradient(135deg,#fff0f5,#ffe0ec);border-radius:0 0 20px 20px;padding:16px 16px 24px;border:2px solid rgba(255,107,157,.4);border-top:none;}

.letter{
  background:white;border-radius:12px;padding:20px 18px;
  box-shadow:0 4px 20px rgba(255,107,157,.15);
  transform:translateY(50px);opacity:0;
  transition:transform .8s .7s cubic-bezier(.34,1.56,.64,1),opacity .8s .7s;
  font-family:'Caveat',cursive;font-size:1.18rem;color:var(--text);line-height:1.9;text-align:left;
}
.letter.revealed{transform:translateY(0);opacity:1;}
.letter-heading{font-family:'Fredoka One',cursive;font-size:1.4rem;color:var(--pink);text-align:center;margin-bottom:14px;}
.letter p{margin-bottom:12px;}
.letter-sig{text-align:right;margin-top:14px;font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--pink);}

.win-stamp{background:linear-gradient(135deg,#ff6b9d,#e0477a);color:white;font-family:'Fredoka One',cursive;font-size:.95rem;padding:10px 28px;border-radius:50px;box-shadow:0 4px 16px rgba(255,107,157,.4);margin:14px auto 0;display:inline-block;animation:popIn .5s 1.6s cubic-bezier(.34,1.56,.64,1) both;}
.save-btn{background:white;color:var(--pink);border:2px solid var(--pink);font-family:'Fredoka One',cursive;font-size:.9rem;padding:9px 26px;border-radius:50px;cursor:pointer;margin-top:10px;display:inline-block;transition:transform .15s,background .2s;animation:popIn .5s 2s cubic-bezier(.34,1.56,.64,1) both;}
.save-btn:hover{background:var(--soft);transform:scale(1.05);}

@media(max-width:480px){
  .letter{font-size:1.12rem;padding:16px 14px;line-height:1.85;}
  .letter-heading{font-size:1.2rem;}
  .win-emoji-row{font-size:2.2rem;letter-spacing:4px;}
  #win-screen{padding:16px 0 60px;}
}

/* â•â• HELPERS â•â• */
@keyframes shake{0%{transform:translate(0,0);}15%{transform:translate(-8px,4px) rotate(-1deg);}30%{transform:translate(8px,-4px) rotate(1deg);}45%{transform:translate(-6px,6px) rotate(-.5deg);}60%{transform:translate(6px,-2px) rotate(.5deg);}75%{transform:translate(-3px,3px);}90%{transform:translate(3px,-3px);}100%{transform:translate(0,0);}}
@keyframes megashake{0%{transform:translate(0,0);}10%{transform:translate(-18px,10px) rotate(-3deg);}20%{transform:translate(18px,-10px) rotate(3deg);}30%{transform:translate(-14px,14px) rotate(-2deg);}40%{transform:translate(14px,-6px) rotate(2deg);}50%{transform:translate(-9px,9px);}60%{transform:translate(9px,-9px);}70%{transform:translate(-5px,5px);}80%{transform:translate(5px,-5px);}90%{transform:translate(-2px,2px);}100%{transform:translate(0,0);}}
.shaking{animation:shake .5s ease!important;}
.megashaking{animation:megashake .8s ease!important;}
.floaty{position:fixed;font-size:2rem;pointer-events:none;z-index:200;animation:fa 1.2s ease forwards;}
@keyframes fa{0%{transform:translateY(0) scale(1);opacity:1;}100%{transform:translateY(-130px) scale(1.5);opacity:0;}}
.chaos-text{position:fixed;font-family:'Fredoka One',cursive;font-size:1.4rem;color:var(--pink);pointer-events:none;z-index:300;animation:cf 1.1s ease forwards;text-shadow:0 2px 8px rgba(255,107,157,.4);}
@keyframes cf{0%{opacity:1;transform:translateY(0) rotate(0);}100%{opacity:0;transform:translateY(-90px) rotate(20deg);}}
</style>
</head>
<body>
<canvas id="particles"></canvas>
<canvas id="fireworks"></canvas>
<button id="musicBtn" onclick="toggleMusic()">ğŸµ</button>

<!-- DOOR -->
<div id="door-screen">
  <div class="door-label">âœ¨ Someone's at the doorâ€¦ âœ¨</div>
  <div class="door-frame" id="doorFrame">
    <div class="door-arch">
      <div class="door-reveal" id="doorReveal">
        <div class="bear-peek">ğŸ»</div>
        <p>Hi Pampam!! ğŸ‘‰ğŸ‘ˆ<br>I have something to askâ€¦</p>
      </div>
      <div class="door-left" id="doorLeft">
        <div class="door-panel"></div><div class="door-panel"></div><div class="door-knob"></div>
      </div>
      <div class="door-right" id="doorRight">
        <div class="door-panel"></div><div class="door-panel"></div><div class="door-knob"></div>
      </div>
    </div>
  </div>
  <div class="door-step"></div>
  <div class="knock-bubble" id="knockBubble">*knock knock* ğŸ¾</div>
  <button class="open-btn" onclick="openDoor()">Open the door ğŸšª</button>
</div>

<!-- CARD -->
<div class="card" id="card">
  <div id="q-state">
    <div class="health-wrap">
      <span class="hl">ğŸ» Bear HP</span>
      <div class="hbg"><div class="hbar" id="healthBar"></div></div>
      <span class="hl" id="hpNum">100</span>
    </div>
    <div class="bear-wrap"><span class="bear" id="bear">ğŸ»</span></div>
    <div class="bubble" id="bubble">Pampamâ€¦ I have something important to ask ğŸ‘‰ğŸ‘ˆ</div>
    <p class="question">Will you be my Valentine?</p>

    <div class="no-counter-wrap" id="ncw">
      <span id="nct">She hasn't said no yetâ€¦ ğŸ¥º</span>
    </div>

    <div class="btn-row">
      <button class="btn btn-yes" id="btnYes" onclick="handleYes()">Yes!! ğŸ’•</button>
      <button class="btn btn-no"  id="btnNo"  onclick="handleNo()">No ğŸ˜</button>
    </div>

    <div class="dbar-wrap"><div class="dbar" id="dbar"></div></div>
    <div class="dlabel"><span>calm</span><span class="critical" id="crit">âš  CRITICAL</span><span>desperate ğŸ˜­</span></div>

    <div class="reasons-wrap" id="rbox">
      <div>
        <div class="reason-label">ğŸ’Œ tap for a reason I like you</div>
        <div id="rt">Click me! ğŸ«¶</div>
      </div>
    </div>
    <div class="together-wrap" id="tt">loadingâ€¦</div>
  </div>
</div>

<!-- WIN -->
<div id="win-screen">
  <span class="win-emoji-row">ğŸ‰ğŸ’–ğŸ¥³</span>
  <div class="envelope">
    <div class="env-flap-wrap"><div class="env-flap" id="envFlap"></div></div>
    <div class="env-body">
      <div class="letter" id="letter">
        <div class="letter-heading">My Dearest Pampam ğŸŒ¹</div>
        <p>I don't always have the right words, but I hope this little bear can say what my heart has been trying to tell you for a long time now.</p>
        <p>You've been there for me in ways I never expected â€” across all the miles between us, across every silence, across every hard day I thought I couldn't get through. You showed up anyway. You always do. And that means more to me than you'll ever fully know.</p>
        <p>You make me laugh when I forget how to. You keep me safe in the moments I need it most. You're the most cheerful, makulet, and genuinely wonderful soul I've ever had the privilege of loving. ğŸŒ¸</p>
        <p>I know the distance isn't easy. I know our story isn't conventional â€” but you chose me anyway, age gap and all. I don't take that lightly. I carry that with me everywhere, every single day. And I want you to know â€” I see it, I feel it, and I'm so grateful for you.</p>
        <p>I'm sorry for the times I wasn't there the way you deserved. I'm sorry for every moment you needed me and I fell short. But I promise you, Pampam â€” when the time comes, I will make it right. Every single day. That's not just words. That's a promise from this little bear to you. ğŸ»ğŸ¤</p>
        <p>I want to keep doing life with you â€” all the way until we're old and grey and still making each other laugh. ğŸ’•</p>
        <div class="letter-sig">Always, always yours ğŸ«¶</div>
      </div>
      <div style="text-align:center;">
        <div class="win-stamp">ğŸ’Œ Official Valentine Confirmed!</div><br>
        <button class="save-btn" onclick="saveCard()">ğŸ’¾ Save our Valentine Card</button>
      </div>
    </div>
  </div>
</div>

<canvas id="saveCanvas" style="display:none"></canvas>

<script>
// â”€â”€ AUDIO â”€â”€
let audioCtx=null,musicOn=false,musicTimer=null,mIdx=0;
function gCtx(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
function tone(f,type,dur,vol=0.12,delay=0){
  const c=gCtx(),o=c.createOscillator(),g=c.createGain();
  o.connect(g);g.connect(c.destination);o.type=type;
  o.frequency.setValueAtTime(f,c.currentTime+delay);
  g.gain.setValueAtTime(0,c.currentTime+delay);
  g.gain.linearRampToValueAtTime(vol,c.currentTime+delay+.02);
  g.gain.exponentialRampToValueAtTime(.001,c.currentTime+delay+dur);
  o.start(c.currentTime+delay);o.stop(c.currentTime+delay+dur+.05);
}
function sadTrombone(){[220,196,174,156].forEach((f,i)=>tone(f,'sawtooth',.32,.1,i*.18));}
function pop(){tone(880,'sine',.1,.18);tone(1100,'sine',.08,.14,.05);}
function knock(){tone(300,'square',.06,.28);setTimeout(()=>tone(300,'square',.06,.28),180);setTimeout(()=>tone(300,'square',.06,.28),360);}
function doorOpen(){[261,329,392,523].forEach((f,i)=>tone(f,'sine',.3,.12,i*.1));}
function yay(){[523,659,784,1047].forEach((f,i)=>tone(f,'sine',.4,.16,i*.12));}
const MEL=[{f:523,d:.4},{f:587,d:.2},{f:659,d:.4},{f:698,d:.4},{f:784,d:.6},{f:698,d:.2},{f:659,d:.4},{f:587,d:.4},{f:523,d:.6},{f:0,d:.4},{f:392,d:.4},{f:440,d:.2},{f:523,d:.4},{f:587,d:.6},{f:659,d:.4},{f:523,d:.8}];
function playNote(){if(!musicOn)return;const n=MEL[mIdx%MEL.length];mIdx++;if(n.f>0)tone(n.f,'sine',n.d*.85,.05);musicTimer=setTimeout(playNote,n.d*1000);}
function toggleMusic(){musicOn=!musicOn;document.getElementById('musicBtn').textContent=musicOn?'ğŸ”‡':'ğŸµ';if(musicOn){gCtx();if(audioCtx.state==='suspended')audioCtx.resume();playNote();}else clearTimeout(musicTimer);}

// â”€â”€ PARTICLES â”€â”€
const pCv=document.getElementById('particles'),pCx=pCv.getContext('2d');
let W,H,pts=[];
function rsz(){W=pCv.width=window.innerWidth;H=pCv.height=window.innerHeight;}rsz();window.addEventListener('resize',rsz);
const pEm=['ğŸ’•','ğŸŒ¸','âœ¨','ğŸ’«','ğŸ©·','ğŸŒ·'];
for(let i=0;i<28;i++)sp(true);
function sp(r=false){pts.push({x:Math.random()*W,y:r?Math.random()*H:H+20,vx:(Math.random()-.5)*.8,vy:-(Math.random()*1+.4),em:pEm[Math.floor(Math.random()*pEm.length)],sz:Math.random()*16+10,al:Math.random()*.4+.1,rot:Math.random()*360,rv:(Math.random()-.5)*2});}
function drawP(){pCx.clearRect(0,0,W,H);for(let i=pts.length-1;i>=0;i--){const p=pts[i];p.x+=p.vx;p.y+=p.vy;p.rot+=p.rv;pCx.save();pCx.globalAlpha=p.al;pCx.font=p.sz+'px serif';pCx.translate(p.x,p.y);pCx.rotate(p.rot*Math.PI/180);pCx.fillText(p.em,-p.sz/2,-p.sz/2);pCx.restore();if(p.y<-40)pts.splice(i,1);}if(Math.random()<.06)sp();requestAnimationFrame(drawP);}drawP();

// â”€â”€ FIREWORKS â”€â”€
const fwCv=document.getElementById('fireworks'),fwCx=fwCv.getContext('2d');
fwCv.width=window.innerWidth;fwCv.height=window.innerHeight;
window.addEventListener('resize',()=>{fwCv.width=window.innerWidth;fwCv.height=window.innerHeight;});
let fwOn=false,fwPts=[];
function launchFW(){const x=Math.random()*fwCv.width,y=Math.random()*fwCv.height*.6;const cols=['#ff6b9d','#ffd166','#c77dff','#06d6a0','#ff3860','#ffb3cf'];const em=['ğŸ’•','ğŸ’–','âœ¨','ğŸŒ¸','ğŸ’—'];const col=cols[Math.floor(Math.random()*cols.length)];for(let i=0;i<26;i++){const a=(Math.PI*2*i)/26,s=Math.random()*5+2;fwPts.push({x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,alpha:1,col,sz:Math.random()*4+2,em:Math.random()<.3?em[Math.floor(Math.random()*em.length)]:null});}}
function animFW(){if(!fwOn){fwCx.clearRect(0,0,fwCv.width,fwCv.height);return;}fwCx.clearRect(0,0,fwCv.width,fwCv.height);for(let i=fwPts.length-1;i>=0;i--){const p=fwPts[i];p.x+=p.vx;p.y+=p.vy;p.vy+=.12;p.vx*=.98;p.alpha-=.018;if(p.alpha<=0){fwPts.splice(i,1);continue;}fwCx.save();fwCx.globalAlpha=p.alpha;if(p.em){fwCx.font='18px serif';fwCx.fillText(p.em,p.x,p.y);}else{fwCx.beginPath();fwCx.arc(p.x,p.y,p.sz,0,Math.PI*2);fwCx.fillStyle=p.col;fwCx.fill();}fwCx.restore();}if(Math.random()<.08)launchFW();requestAnimationFrame(animFW);}

// â”€â”€ DOOR â”€â”€
let knockCount=0,doorDone=false;
setTimeout(()=>{doKnock();setTimeout(doKnock,600);setTimeout(doKnock,1100);},1200);
setTimeout(()=>{if(!doorDone)doKnock();},4500);
setTimeout(()=>{if(!doorDone)doKnock();},8000);
function doKnock(){
  if(doorDone)return;knockCount++;knock();
  const f=document.getElementById('doorFrame');
  f.classList.remove('knocking');void f.offsetWidth;f.classList.add('knocking');
  setTimeout(()=>f.classList.remove('knocking'),450);
  const b=document.getElementById('knockBubble');
  if(knockCount===1)b.textContent='*knock knock* ğŸ¾';
  else if(knockCount===2)b.textContent='*knock knock knock* â€¦hello?? ğŸ¥º';
  else if(knockCount===3)b.textContent='Pampaaaam please open up!! ğŸ»ğŸ’•';
  else b.textContent='I\'m still hereâ€¦ ğŸ˜¢ğŸ’•';
}
function openDoor(){
  if(doorDone)return;doorDone=true;doorOpen();
  document.getElementById('doorLeft').classList.add('open');
  document.getElementById('doorRight').classList.add('open');
  setTimeout(()=>document.getElementById('doorReveal').classList.add('show'),500);
  setTimeout(()=>{
    document.getElementById('door-screen').style.display='none';
    const c=document.getElementById('card');
    c.classList.add('visible','ps');
    updateTT();setInterval(updateTT,1000);
  },2000);
}

// â”€â”€ TOGETHER TIMER â”€â”€
const SINCE=new Date('2025-11-01T00:00:00');
function updateTT(){
  const d=Date.now()-SINCE,dy=Math.floor(d/86400000),h=Math.floor((d%86400000)/3600000),m=Math.floor((d%3600000)/60000),s=Math.floor((d%60000)/1000);
  const el=document.getElementById('tt');
  if(el)el.innerHTML=`ğŸ•° Together for <span>${dy}d ${h}h ${m}m ${s}s</span>`;
}

// â”€â”€ REASONS â”€â”€
const REASONS=[
  "You're there for me even when miles separate us ğŸŒğŸ’•",
  "You always care â€” I feel it every single day ğŸ«¶",
  "You make me laugh when I forget how to ğŸ˜„",
  "You keep me safe in the moments I need it most ğŸ ğŸ’—",
  "The most cheerful person I know â˜€ï¸",
  "Makulet and cute as always â€” wouldn't change a thing ğŸ£",
  "You chose me, and I carry that with me everywhere ğŸ’›",
  "I want to grow old with you, still laughing, still us ğŸ‘´ğŸ‘µğŸ’•",
];
let rIdx=0;
document.getElementById('rbox').addEventListener('click',()=>{
  const el=document.getElementById('rt');
  el.style.opacity='0';
  setTimeout(()=>{el.textContent=REASONS[rIdx%REASONS.length];rIdx++;el.style.opacity='1';},200);
  pop();
});
document.getElementById('rt').style.transition='opacity .2s';

// â”€â”€ NO BUTTON LOGIC â”€â”€
let noPresses=0;const MAX=9;
const bearEl=document.getElementById('bear'),bubbleEl=document.getElementById('bubble');
const btnNo=document.getElementById('btnNo'),btnYes=document.getElementById('btnYes');
const dbar=document.getElementById('dbar'),card=document.getElementById('card');
const hbar=document.getElementById('healthBar'),hpNum=document.getElementById('hpNum');
const ncw=document.getElementById('ncw');

const BEARS=['ğŸ»','ğŸ¥º','ğŸ˜¢','ğŸ˜­','ğŸ˜±','ğŸ¤¯','ğŸ’€','ğŸ‘»','ğŸ«¥'];
const DIALOGUE=["Waitâ€¦ did you just say no? ğŸ˜¶","Oh no no noâ€¦ please reconsider ğŸ¥º","The bear is starting to cryâ€¦ ğŸ˜¢","TEARS. ACTUAL TEARS. ğŸ˜­ğŸ’§","I am SHOOKETH to my core!! ğŸ˜±","My little heart is SHATTERING ğŸ’”","This is a CRISIS. A BEAR EMERGENCY. ğŸš¨","The No button is almost goneâ€¦ please say yes!!","ok fineâ€¦ *(sniffles)*â€¦ last chanceâ€¦"];
const NO_LABELS=["No ğŸ˜","Nope","Still no","Nooooo","I said no!","NO!!","nO","É´á´","â‚™â‚’"];
const NO_SIZES=[1.3,1.15,1.0,.88,.76,.62,.5,.38,.26];
const NO_PADS=[[16,44],[14,38],[13,32],[11,26],[9,20],[7,14],[6,10],[5,7],[4,5]];
const DRAMA=['','d1','d2','d3','d4','d5'];

function updateHP(){
  const hp=Math.max(0,100-noPresses*11);
  hbar.style.width=hp+'%';hpNum.textContent=hp<=0?'ğŸ’€':hp;
  hbar.className=hp<=33?'hbar d':hp<=60?'hbar w':'hbar';
}
function updateCounter(){
  ncw.classList.add('active');
  const msgs=['','time she said noâ€¦ really?? ğŸ˜­','times she said noâ€¦ please ğŸ¥º','times she said noâ€¦ please ğŸ¥º','timesâ€¦ the bear is suffering ğŸ˜­ğŸ’”','timesâ€¦ the bear is suffering ğŸ˜­ğŸ’”','timesâ€¦ the bear is suffering ğŸ˜­ğŸ’”','timesâ€¦ BEAR EMERGENCY ğŸš¨','timesâ€¦ BEAR EMERGENCY ğŸš¨','timesâ€¦ (no button has passed away ğŸ’€)'];
  ncw.innerHTML=`<span class="ncb">${noPresses}</span><span>${msgs[Math.min(noPresses,msgs.length-1)]}</span>`;
}
function shakeCard(mega=false){
  const cls=mega?'megashaking':'shaking';
  card.classList.remove('shaking','megashaking');void card.offsetWidth;card.classList.add(cls);
  setTimeout(()=>card.classList.remove(cls),mega?800:500);
  if(navigator.vibrate)navigator.vibrate(mega?[80,40,80,40,120]:[60,30,60]);
}
function spawnTear(){
  const bw=document.querySelector('.bear-wrap');
  for(let i=0;i<3;i++){const t=document.createElement('span');t.className='tear';t.textContent='ğŸ’§';t.style.left=(Math.random()*60-10)+'px';t.style.top='60px';t.style.animationDelay=(i*.15)+'s';bw.appendChild(t);setTimeout(()=>t.remove(),1200);}
}
function floaty(em,x,y){const el=document.createElement('div');el.className='floaty';el.textContent=em;el.style.left=x+'px';el.style.top=y+'px';document.body.appendChild(el);setTimeout(()=>el.remove(),1300);}
function chaos(txt){const el=document.createElement('div');el.className='chaos-text';el.textContent=txt;el.style.left=Math.random()*60+20+'vw';el.style.top=Math.random()*40+20+'vh';document.body.appendChild(el);setTimeout(()=>el.remove(),1200);}
function growYes(){const sc=Math.min(1+noPresses*.09,1.85),gl=noPresses*4;btnYes.style.transform=`scale(${sc})`;btnYes.style.boxShadow=`0 ${6+gl}px ${24+gl*3}px rgba(255,107,157,${.4+noPresses*.05})`;}

// Escape on hover after 3 presses
btnNo.addEventListener('mouseenter',()=>{
  if(noPresses<3||noPresses>=MAX)return;
  const dirs=['translateX(-80px)','translateX(80px)','translateY(-45px)','translateY(45px)','translate(-70px,-30px)','translate(70px,-30px)'];
  btnNo.style.transform=dirs[Math.floor(Math.random()*dirs.length)];
  setTimeout(()=>{if(noPresses<MAX)btnNo.style.transform='';},700);
});

// Magnetic yes after 4 presses
document.addEventListener('mousemove',e=>{
  if(noPresses<4)return;
  const r=btnYes.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2;
  const dist=Math.hypot(e.clientX-cx,e.clientY-cy);
  if(dist<180){const pull=(1-dist/180)*18,dx=(e.clientX-cx)/dist*pull,dy=(e.clientY-cy)/dist*pull,sc=Math.min(1+noPresses*.09,1.85);btnYes.style.transform=`translate(${dx}px,${dy}px) scale(${sc})`;}
});

function handleNo(){
  noPresses++;
  bearEl.textContent=BEARS[Math.min(noPresses,BEARS.length-1)];
  bearEl.className='bear sad';
  if(noPresses<MAX)setTimeout(()=>{bearEl.className='bear';},600);
  if(noPresses>=MAX)bearEl.className='bear faint';
  bubbleEl.textContent=DIALOGUE[Math.min(noPresses-1,DIALOGUE.length-1)];
  updateHP();updateCounter();
  const i=Math.min(noPresses,NO_SIZES.length-1);
  btnNo.textContent=NO_LABELS[Math.min(noPresses,NO_LABELS.length-1)];
  btnNo.style.fontSize=NO_SIZES[i]+'rem';
  btnNo.style.padding=NO_PADS[i][0]+'px '+NO_PADS[i][1]+'px';
  dbar.style.width=((noPresses/MAX)*100)+'%';
  if(noPresses>=7)document.getElementById('crit').style.display='inline';
  growYes();
  document.body.className=DRAMA[Math.min(noPresses,DRAMA.length-1)];
  card.classList.remove('ps','pf','pp');
  if(noPresses<=3)card.classList.add('ps');else if(noPresses<=6)card.classList.add('pf');else card.classList.add('pp');
  if(noPresses>=2)shakeCard(noPresses>=6);
  if(noPresses>=2)spawnTear();
  sadTrombone();
  const ct=['','','WHY?! ğŸ˜±','PLEASE ğŸ¥º','NOOOO ğŸ˜­','MY HEART ğŸ’”','BEAR EMERGENCY ğŸš¨','last chance!!','... ğŸ’€'];
  if(ct[noPresses])chaos(ct[noPresses]);
  const fp=['ğŸ˜±','ğŸ’”','ğŸ˜­','ğŸ¥º','â“','ğŸ’€','ğŸ‘€','ğŸ˜¤'];
  const r=btnNo.getBoundingClientRect();floaty(fp[Math.min(noPresses-1,fp.length-1)],r.left+r.width/2,r.top-20);
  if(noPresses>=MAX){btnNo.style.opacity='0';btnNo.style.pointerEvents='none';setTimeout(()=>btnNo.style.display='none',400);bearEl.textContent='ğŸ˜­';bubbleEl.textContent="(The No button passed awayâ€¦ it's just you and Yes now ğŸ’€)";}
}

// â”€â”€ YES â”€â”€
function handleYes(){
  yay();if(navigator.vibrate)navigator.vibrate([50,20,50,20,200]);
  bearEl.textContent='ğŸ»';bearEl.className='bear happy';
  document.getElementById('q-state').style.display='none';
  card.style.display='none';

  // Switch body to scrollable centered layout
  document.body.style.overflow='auto';
  document.body.style.display='flex';
  document.body.style.flexDirection='column';
  document.body.style.alignItems='center';
  document.body.style.justifyContent='flex-start';
  document.body.style.paddingTop='24px';
  document.body.style.paddingBottom='60px';

  const ws=document.getElementById('win-screen');
  ws.style.display='flex';

  setTimeout(()=>{document.getElementById('envFlap').classList.add('open');setTimeout(()=>document.getElementById('letter').classList.add('revealed'),800);},300);
  fwOn=true;animFW();document.body.className='';
  celebrate();setTimeout(celebrate,700);setTimeout(celebrate,1400);
}
function celebrate(){
  const em=['ğŸ’–','ğŸ’•','ğŸ‰','ğŸŒ¸','âœ¨','ğŸ¥³','ğŸ’','ğŸŒ·','ğŸŠ','ğŸ’—'];
  for(let i=0;i<60;i++){setTimeout(()=>{const el=document.createElement('div');el.className='floaty';el.textContent=em[Math.floor(Math.random()*em.length)];el.style.left=Math.random()*95+'vw';el.style.top=Math.random()*90+'vh';el.style.fontSize=(Math.random()*24+14)+'px';el.style.animationDuration=(Math.random()*1+.8)+'s';document.body.appendChild(el);setTimeout(()=>el.remove(),2000);},i*30);}
}

// â”€â”€ SAVE CARD â”€â”€
function saveCard(){
  const sc=document.getElementById('saveCanvas');sc.width=600;sc.height=400;
  const c=sc.getContext('2d');
  const g=c.createLinearGradient(0,0,600,400);g.addColorStop(0,'#fff0f5');g.addColorStop(1,'#ffe0ec');
  c.fillStyle=g;c.fillRect(0,0,600,400);
  c.strokeStyle='#ff6b9d';c.lineWidth=6;c.beginPath();c.roundRect(10,10,580,380,24);c.stroke();
  const em=['ğŸ’•','ğŸŒ¸','âœ¨','ğŸ’«','ğŸ©·','ğŸŒ·'];c.font='24px serif';
  for(let i=0;i<14;i++)c.fillText(em[i%em.length],Math.random()*560+20,Math.random()*360+20);
  c.fillStyle='rgba(255,255,255,.88)';c.beginPath();c.roundRect(80,60,440,280,20);c.fill();
  c.strokeStyle='rgba(255,107,157,.35)';c.lineWidth=2;c.stroke();
  c.textAlign='center';c.font='40px serif';c.fillText('ğŸ»',300,135);
  c.fillStyle='#e0477a';c.font='bold 24px sans-serif';c.fillText('Official Valentines ğŸ’Œ',300,178);
  c.fillStyle='#3a1a2e';c.font='17px sans-serif';c.fillText('Pampam said YES! ğŸ‰',300,218);c.fillText("Happy Valentine's Day 2026 ğŸ’•",300,250);
  c.fillStyle='#ff6b9d';c.font='13px sans-serif';c.fillText('Made with ğŸ» and lots of love',300,305);
  const a=document.createElement('a');a.download='pampam_valentine.png';a.href=sc.toDataURL('image/png');a.click();
}
</script>
</body>
</html>
